/*!

Name: Tunez
Dependencies: jQuery
Author: Michael Lynch
Author URL: http://michaelynch.com
Date Created: September 10, 2013
Licensed under the MIT license

*/
;(function(e){e.fn.tunez=function(t){if(!this.length){return this}var n={key:null,username:null,limit:5,ordered:true,href:true,album:true,artwork:true,success:function(){},error:function(){}};var r=this;var s=e(this);r.settings={};r.settings=e.extend({},n,t);if(r.settings.key===null){alert("A Last.fm API key is required");return false}if(r.settings.key===null){alert("A Last.fm username is required");return false}var o=r.settings.ordered===true?"ol":"ul";e.ajax({type:"GET",url:"http://ws.audioscrobbler.com/2.0/?method=user.getrecenttracks&user="+r.settings.username+"&api_key="+r.settings.key+"&limit="+r.settings.limit+"&extended=1&format=json",dataType:"jsonp",success:function(t){if(t.recenttracks!==undefined){var n=e("<"+o+' class="tracks"></'+o+">").replaceAll(s);for(i=0;i<t.recenttracks.track.length;i++){n.append('<li><span class="details"><span class="title">'+t.recenttracks.track[i].name+'</span><span class="artist">'+t.recenttracks.track[i].artist.name+"</span></span></li>")}if(r.settings.href===true){n.children("li").each(function(n){e(this).children(".details").children(".title").wrapInner('<a href="'+t.recenttracks.track[n].url+'" target="_blank">');e(this).children(".details").children(".artist").wrapInner('<a href="http://last.fm/music/'+t.recenttracks.track[n].artist.url+'" target="_blank">')})}if(r.settings.album===true){n.children("li").each(function(n){e(this).children(".details").children(".title").after('<span class="album">('+t.recenttracks.track[n].album["#text"]+")</span>")})}if(r.settings.artwork===true){n.children("li").each(function(n){e(this).prepend('<img src="'+t.recenttracks.track[n].image[3]["#text"]+'" alt="'+t.recenttracks.track[n].album["#text"]+'" class="artwork" />')})}r.settings.success.call(this)}},error:function(){r.settings.error.call(this)}})}})(jQuery);