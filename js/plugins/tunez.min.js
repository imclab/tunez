/*!

Name: Tunez
Dependencies: jQuery
Author: Michael Lynch
Author URL: http://michaelynch.com
Date Created: September 10, 2013
Licensed under the MIT license

*/
;(function(a){a.fn.tunez=function(b){if(!this.length){return this;}var f={key:null,username:null,limit:5,ordered:true,href:true,album:true,artwork:true};var e=this;var d=a(this);e.settings={};e.settings=a.extend({},f,b);if(e.settings.key===null){alert("A Last.fm API key is required");return false;}if(e.settings.key===null){alert("A Last.fm username is required");return false;}var c;if(e.settings.ordered===true){c="ol";}else{c="ul";}a.ajax({type:"GET",url:"http://ws.audioscrobbler.com/2.0/?method=user.getrecenttracks&user="+e.settings.username+"&api_key="+e.settings.key+"&limit="+e.settings.limit+"&extended=1&format=json",dataType:"jsonp",success:function(h){console.log(h);if(h.recenttracks!==undefined){var g=a("<"+c+' class="tracks"></'+c+">").replaceAll(d);for(i=0;i<h.recenttracks.track.length;i++){g.append('<li><span class="details"><span class="title">'+h.recenttracks.track[i].name+'</span><span class="artist">'+h.recenttracks.track[i].artist.name+"</span></span></li>");}if(e.settings.href===true){for(i=0;i<g.children("li").length;i++){g.children("li:nth-child("+(i+1)+")").children(".details").children(".title").wrapInner('<a href="'+h.recenttracks.track[i].url+'" target="_blank">');g.children("li:nth-child("+(i+1)+")").children(".details").children(".artist").wrapInner('<a href="http://last.fm/music/'+h.recenttracks.track[i].artist.url+'" target="_blank">');}}if(e.settings.album===true){for(i=0;i<g.children("li").length;i++){g.children("li:nth-child("+(i+1)+")").children(".details").children(".title").after('<span class="album">('+h.recenttracks.track[i].album["#text"]+")</span>");}}if(e.settings.artwork===true){for(i=0;i<g.children("li").length;i++){g.children("li:nth-child("+(i+1)+")").prepend('<img src="'+h.recenttracks.track[i].image[3]["#text"]+'" alt="'+h.recenttracks.track[i].album["#text"]+'" class="artwork" />');}}}else{alert(h.message);}}});};})(jQuery);